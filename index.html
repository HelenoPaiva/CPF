<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Validador de CPF (matemático) com verificação dos dígitos e região fiscal." />
  <title>CPF válido? — Validador online</title>

  <!-- Tailwind via CDN (ótimo p/ GitHub Pages; 1 arquivo só) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* micro-acabamentos */
    .glass { backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
    .ring-soft { box-shadow: 0 0 0 1px rgba(255,255,255,.08) inset; }
    .animate-in { animation: pop .22s ease-out; }
    @keyframes pop { from { transform: translateY(6px); opacity: .0 } to { transform: translateY(0); opacity: 1 } }
    .mono { font-variant-numeric: tabular-nums; }
  </style>
</head>

<body class="min-h-screen text-slate-100 bg-slate-950">
  <!-- Background -->
  <div class="fixed inset-0 -z-10">
    <div class="absolute inset-0 bg-gradient-to-br from-indigo-950 via-slate-950 to-fuchsia-950"></div>
    <div class="absolute -top-24 -left-24 h-72 w-72 rounded-full bg-indigo-500/20 blur-3xl"></div>
    <div class="absolute top-48 -right-24 h-72 w-72 rounded-full bg-fuchsia-500/20 blur-3xl"></div>
    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 h-80 w-[42rem] rounded-full bg-cyan-400/10 blur-3xl"></div>
  </div>

  <main class="mx-auto max-w-3xl px-4 py-10 sm:py-14">
    <!-- Header -->
    <header class="mb-6 sm:mb-8">
      <div class="inline-flex items-center gap-2 rounded-full bg-white/5 ring-1 ring-white/10 px-3 py-1 text-xs text-slate-200">
        <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
        Validação matemática (dígitos verificadores)
      </div>
      <h1 class="mt-4 text-3xl sm:text-4xl font-semibold tracking-tight">
        CPF válido?
      </h1>
      <p class="mt-2 text-slate-300 leading-relaxed">
        Cole um CPF (com ou sem pontuação). O sistema sanitiza, valida os dígitos e mostra a região fiscal do 9º dígito.
      </p>
    </header>

    <!-- Card -->
    <section class="glass ring-soft rounded-2xl border border-white/10 bg-white/5 p-5 sm:p-6">
      <!-- Input row -->
      <div class="flex flex-col gap-3">
        <label class="text-sm text-slate-200" for="cpfInput">CPF</label>

        <div class="flex flex-col sm:flex-row gap-3">
          <div class="relative flex-1">
            <input
              id="cpfInput"
              inputmode="numeric"
              autocomplete="off"
              spellcheck="false"
              placeholder="000.000.000-00"
              class="w-full rounded-xl bg-slate-900/60 border border-white/10 px-4 py-3 pr-28 text-lg mono outline-none
                     focus:border-indigo-400/50 focus:ring-4 focus:ring-indigo-400/15"
            />
            <div class="absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1">
              <button id="pasteBtn" type="button"
                class="rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-2 text-xs text-slate-200">
                Colar
              </button>
              <button id="clearBtn" type="button"
                class="rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-2 text-xs text-slate-200">
                Limpar
              </button>
            </div>
          </div>

          <div class="flex gap-2">
            <button id="validateBtn" type="button"
              class="flex-1 sm:flex-none rounded-xl bg-indigo-500 hover:bg-indigo-400 active:bg-indigo-500/90
                     text-white px-4 py-3 font-semibold shadow-lg shadow-indigo-500/20">
              Validar
            </button>
            <button id="genBtn" type="button"
              class="flex-1 sm:flex-none rounded-xl bg-white/5 hover:bg-white/10 border border-white/10
                     text-slate-100 px-4 py-3 font-semibold">
              Gerar
            </button>
          </div>
        </div>

        <!-- Helper row -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm text-slate-300">
          <div class="flex items-center gap-2">
            <span class="inline-block rounded-full bg-white/5 border border-white/10 px-2 py-1 text-xs">
              Sanitizado:
            </span>
            <span id="sanitized" class="mono text-slate-100/90">—</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="copyBtn" type="button"
              class="rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-2 text-xs text-slate-200">
              Copiar CPF limpo
            </button>
            <button id="copyMaskedBtn" type="button"
              class="rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-2 text-xs text-slate-200">
              Copiar com máscara
            </button>
          </div>
        </div>
      </div>

      <!-- Result -->
      <div id="resultWrap" class="mt-5 hidden">
        <div id="resultBox" class="animate-in rounded-2xl border p-4 sm:p-5">
          <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
            <div>
              <div class="flex items-center gap-2">
                <span id="badgeDot" class="h-2.5 w-2.5 rounded-full"></span>
                <h2 id="resultTitle" class="text-lg font-semibold">—</h2>
              </div>
              <p id="resultMsg" class="mt-1 text-slate-200/90">—</p>
            </div>

            <div class="text-sm text-slate-200/90">
              <div class="rounded-xl bg-black/20 border border-white/10 px-4 py-3">
                <div class="text-xs text-slate-300">Região fiscal (9º dígito)</div>
                <div id="region" class="mt-1 font-semibold">—</div>
              </div>
            </div>
          </div>

          <!-- Details -->
          <details class="mt-4 group">
            <summary class="cursor-pointer select-none text-sm text-slate-200/90 hover:text-slate-100">
              <span class="inline-flex items-center gap-2">
                Detalhes do cálculo
                <span class="text-slate-400 group-open:rotate-90 transition-transform">›</span>
              </span>
            </summary>
            <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
              <div class="rounded-xl bg-black/20 border border-white/10 p-4">
                <div class="text-xs text-slate-300">1º dígito verificador (X)</div>
                <div class="mt-1 mono">
                  <span class="text-slate-300">Calculado:</span> <span id="dxCalc" class="font-semibold">—</span><br/>
                  <span class="text-slate-300">Informado:</span> <span id="dxInf" class="font-semibold">—</span>
                </div>
              </div>
              <div class="rounded-xl bg-black/20 border border-white/10 p-4">
                <div class="text-xs text-slate-300">2º dígito verificador (Y)</div>
                <div class="mt-1 mono">
                  <span class="text-slate-300">Calculado:</span> <span id="dyCalc" class="font-semibold">—</span><br/>
                  <span class="text-slate-300">Informado:</span> <span id="dyInf" class="font-semibold">—</span>
                </div>
              </div>
              <div class="rounded-xl bg-black/20 border border-white/10 p-4 sm:col-span-2">
                <div class="text-xs text-slate-300">Pesos</div>
                <div class="mt-1 mono text-slate-200/90">
                  1º dígito: 10..2 (9 dígitos)<br/>
                  2º dígito: 11..2 (10 dígitos)
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>

      <!-- Footer note -->
      <p class="mt-5 text-xs text-slate-400 leading-relaxed">
        Observação: esta validação é <b>matemática</b> (formato + dígitos verificadores). Um CPF matematicamente válido
        pode não estar ativo/regular na Receita.
      </p>
    </section>

    <!-- Small footer -->
    <footer class="mt-8 text-center text-xs text-slate-500">
      Feito para rodar 100% client-side (HTML único).
    </footer>
  </main>

  <script>
    // -------------------------
    // CPF utils (client-side)
    // -------------------------

    const REGION = {
      0: "Rio Grande do Sul",
      1: "Distrito Federal, Goiás, Mato Grosso, Mato Grosso do Sul ou Tocantins",
      2: "Amazonas, Pará, Roraima, Amapá, Acre ou Rondônia",
      3: "Ceará, Maranhão ou Piauí",
      4: "Paraíba, Pernambuco, Alagoas ou Rio Grande do Norte",
      5: "Bahia ou Sergipe",
      6: "Minas Gerais",
      7: "Rio de Janeiro ou Espírito Santo",
      8: "São Paulo",
      9: "Paraná ou Santa Catarina"
    };

    function onlyDigits(str) {
      return (str || "").replace(/\D+/g, "");
    }

    function maskCpf(digits11) {
      const d = onlyDigits(digits11);
      if (d.length !== 11) return d;
      return `${d.slice(0,3)}.${d.slice(3,6)}.${d.slice(6,9)}-${d.slice(9,11)}`;
    }

    function allSameDigits(d) {
      return /^(\d)\1{10}$/.test(d);
    }

    // Standard CPF check-digit:
    // sum = Σ digit[i] * weight; weight decreases
    // remainder = sum % 11
    // dv = (remainder < 2) ? 0 : (11 - remainder)
    function calcDv(baseDigits, startWeight) {
      let sum = 0;
      for (let i = 0; i < baseDigits.length; i++) {
        sum += Number(baseDigits[i]) * (startWeight - i);
      }
      const rem = sum % 11;
      return rem < 2 ? 0 : (11 - rem);
    }

    function validateCpf(raw) {
      const cpf = onlyDigits(raw);

      if (cpf.length === 0) {
        return { valid: false, cpf, reason: "Digite um CPF para validar.", dx: null, dy: null, region: null };
      }
      if (cpf.length !== 11) {
        return { valid: false, cpf, reason: "CPF inválido: quantidade de dígitos diferente de 11.", dx: null, dy: null, region: null };
      }
      if (allSameDigits(cpf)) {
        return { valid: false, cpf, reason: "CPF inválido: sequência repetida (ex.: 111.111.111-11).", dx: null, dy: null, region: null };
      }

      const base9 = cpf.slice(0, 9);
      const dxInf = Number(cpf[9]);
      const dyInf = Number(cpf[10]);

      const dxCalc = calcDv(base9, 10);
      const base10 = base9 + String(dxCalc);
      const dyCalc = calcDv(base10, 11);

      if (dxCalc !== dxInf) {
        return { valid: false, cpf, reason: "CPF inválido: 1º dígito verificador (X) não confere.", dxCalc, dxInf, dyCalc, dyInf, region: null };
      }
      if (dyCalc !== dyInf) {
        return { valid: false, cpf, reason: "CPF inválido: 2º dígito verificador (Y) não confere.", dxCalc, dxInf, dyCalc, dyInf, region: null };
      }

      const regionDigit = Number(cpf[8]); // equivalente a cpf[-3]
      const region = REGION[regionDigit] ?? "Região não identificada";

      return { valid: true, cpf, reason: "CPF matematicamente válido.", dxCalc, dxInf, dyCalc, dyInf, region };
    }

    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateValidCpf() {
      // gera base aleatória (evita todos iguais)
      let base9 = "";
      do {
        base9 = "";
        for (let i = 0; i < 9; i++) base9 += String(randomInt(0, 9));
      } while (allSameDigits(base9 + "00")); // checagem simples

      const dx = calcDv(base9, 10);
      const dy = calcDv(base9 + String(dx), 11);
      return base9 + String(dx) + String(dy);
    }

    // -------------------------
    // UI wiring
    // -------------------------

    const el = (id) => document.getElementById(id);

    const cpfInput = el("cpfInput");
    const sanitized = el("sanitized");

    const resultWrap = el("resultWrap");
    const resultBox = el("resultBox");
    const resultTitle = el("resultTitle");
    const resultMsg = el("resultMsg");
    const badgeDot = el("badgeDot");
    const region = el("region");

    const dxCalc = el("dxCalc");
    const dxInf = el("dxInf");
    const dyCalc = el("dyCalc");
    const dyInf = el("dyInf");

    function setResult(state) {
      // state: { valid, cpf, reason, region, dxCalc, dxInf, dyCalc, dyInf }
      resultWrap.classList.remove("hidden");
      resultBox.classList.remove("border-emerald-400/30", "bg-emerald-500/10", "border-rose-400/30", "bg-rose-500/10");
      badgeDot.classList.remove("bg-emerald-400", "bg-rose-400");

      if (state.valid) {
        resultBox.classList.add("border-emerald-400/30", "bg-emerald-500/10");
        badgeDot.classList.add("bg-emerald-400");
        resultTitle.textContent = "Válido";
        resultMsg.textContent = `${maskCpf(state.cpf)} — ${state.reason}`;
        region.textContent = state.region || "—";
      } else {
        resultBox.classList.add("border-rose-400/30", "bg-rose-500/10");
        badgeDot.classList.add("bg-rose-400");
        resultTitle.textContent = "Inválido";
        resultMsg.textContent = `${state.cpf ? maskCpf(state.cpf) : "—"} — ${state.reason}`;
        region.textContent = "—";
      }

      // details
      dxCalc.textContent = state.dxCalc ?? "—";
      dxInf.textContent  = (state.dxInf ?? (state.cpf?.length === 11 ? state.cpf[9] : null)) ?? "—";
      dyCalc.textContent = state.dyCalc ?? "—";
      dyInf.textContent  = (state.dyInf ?? (state.cpf?.length === 11 ? state.cpf[10] : null)) ?? "—";
    }

    function refreshSanitized() {
      const clean = onlyDigits(cpfInput.value);
      sanitized.textContent = clean.length ? clean : "—";
    }

    function validateNow() {
      const res = validateCpf(cpfInput.value);
      setResult(res);
    }

    // Input mask (leve, sem biblioteca)
    function applyMaskPreserveCaret(inputEl) {
      const start = inputEl.selectionStart;
      const before = inputEl.value;

      const clean = onlyDigits(before).slice(0, 11);
      const masked = maskCpf(clean);

      inputEl.value = masked;

      // tentativa simples de manter caret no fim (bom o suficiente p/ uso geral)
      if (document.activeElement === inputEl) {
        const delta = masked.length - before.length;
        const pos = Math.max(0, Math.min(masked.length, (start ?? masked.length) + delta));
        inputEl.setSelectionRange(pos, pos);
      }
    }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        toast("Copiado!");
      } catch {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast("Copiado!");
      }
    }

    // mini toast
    let toastTimer = null;
    function toast(msg) {
      let t = document.getElementById("toast");
      if (!t) {
        t = document.createElement("div");
        t.id = "toast";
        t.className = "fixed bottom-5 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-xl bg-black/60 border border-white/10 text-slate-100 text-sm glass animate-in";
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.style.opacity = "1";
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => { t.style.opacity = "0"; }, 1200);
    }

    // Events
    cpfInput.addEventListener("input", () => {
      applyMaskPreserveCaret(cpfInput);
      refreshSanitized();

      // validação “ao vivo” quando completar 11 dígitos
      if (onlyDigits(cpfInput.value).length === 11) validateNow();
      else resultWrap.classList.add("hidden");
    });

    el("validateBtn").addEventListener("click", validateNow);

    el("clearBtn").addEventListener("click", () => {
      cpfInput.value = "";
      refreshSanitized();
      resultWrap.classList.add("hidden");
      cpfInput.focus();
    });

    el("pasteBtn").addEventListener("click", async () => {
      try {
        const txt = await navigator.clipboard.readText();
        cpfInput.value = maskCpf(onlyDigits(txt).slice(0, 11));
        refreshSanitized();
        validateNow();
        cpfInput.focus();
      } catch {
        toast("Permita acesso à área de transferência.");
      }
    });

    el("copyBtn").addEventListener("click", () => {
      const clean = onlyDigits(cpfInput.value);
      if (!clean) return toast("Nada para copiar.");
      copyText(clean);
    });

    el("copyMaskedBtn").addEventListener("click", () => {
      const clean = onlyDigits(cpfInput.value);
      if (!clean) return toast("Nada para copiar.");
      copyText(maskCpf(clean));
    });

    el("genBtn").addEventListener("click", () => {
      const cpf = generateValidCpf();
      cpfInput.value = maskCpf(cpf);
      refreshSanitized();
      validateNow();
      cpfInput.focus();
      toast("CPF válido gerado.");
    });

    // Init
    refreshSanitized();
  </script>
</body>
</html>
